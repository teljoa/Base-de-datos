dffyhf#DROP TABLE DEPART;
#DROP TABLE EMPLE;
#DROP TABLE HERRAMIENTAS;
#DROP TABLE HOSPITALES;
#DROP TABLE PERSONAS;
#DROP TABLE MEDICOS;

CREATE TABLE DEPART(
DEPT_NO INT(10),
DNOMBRE VARCHAR(50),
LOC VARCHAR(50),
CONSTRAINT pk_depa PRIMARY KEY(DEPT_NO)
);

CREATE TABLE EMPLE(
EMP_NO INT(10),
APELLIDO VARCHAR(50),
OFICIO VARCHAR(50),
DIR INT(4),
FECHA_ALT DATE,
SALARIO DOUBLE,
COMISION DOUBLE,
DEPT_NO INT(10),
CONSTRAINT pk_empl PRIMARY KEY(EMP_NO),
CONSTRAINT fk_empl FOREIGN KEY(DEPT_NO) REFERENCES DEPART(DEPT_NO)
);

CREATE TABLE HERRAMIENTAS(
DESCRIPCION VARCHAR(50),
ESTANTERIA INT(10),
UNIDADES INT(10),
CONSTRAINT pk_her PRIMARY KEY(DESCRIPCION)
);

CREATE TABLE HOSPITALES(
COD_HOSPITAL INT(10),
NOMBRE VARCHAR(50),
DIRECCION VARCHAR(50),
NUM_PLAZAS INT(10),
CONSTRAINT pk_hos PRIMARY KEY(COD_HOSPITAL)
);

CREATE TABLE PERSONAS(
COD_HOSPITAL INT(10),
DNI VARCHAR(10),
APELLIDOS VARCHAR(50),
FUNCION VARCHAR(50),
SALARIO DOUBLE,
CONSTRAINT pk_per PRIMARY KEY(DNI,APELLIDOS),
CONSTRAINT fk1_per FOREIGN KEY(COD_HOSPITAL) REFERENCES HOSPITALES(COD_HOSPITAL)
);

CREATE TABLE MEDICOS(
COD_HOSPITAL INT(10),
DNI VARCHAR(10),
APELLIDOS VARCHAR(50),
ESPECIALIDAD VARCHAR(50),
CONSTRAINT pk_med PRIMARY KEY(COD_HOSPITAL,DNI,APELLIDOS),
CONSTRAINT fk1_med FOREIGN KEY(COD_HOSPITAL) REFERENCES HOSPITALES(COD_HOSPITAL),
CONSTRAINT fk2_med FOREIGN KEY(DNI, APELLIDOS) REFERENCES PERSONAS(DNI, APELLIDOS)
);

INSERT INTO DEPART
VALUES(10, 'CONTABILIDAD', 'SEVILLA');

INSERT INTO DEPART
VALUES(20, 'INVESTIGACION', 'MADRID');

INSERT INTO DEPART
VALUES(30, 'VENTAS', 'BARCELONA');

INSERT INTO DEPART
VALUES(40, 'PRODUCCION', 'BILBAO');

INSERT INTO EMPLE
VALUES(7369, 'SANCHEZ', 'EMPLEADO', 7902, '1980-12-17', 104000, NULL, 20);

INSERT INTO EMPLE
VALUES(7499, 'ARROYO', 'VENDEDOR', 7698, '1980-02-20', 208000, 39000, 30);

INSERT INTO EMPLE
VALUES(7521, 'SALA', 'VENDEDOR', 7698, '1981-02-22', 162500, 162500, 30);

INSERT INTO EMPLE
VALUES(7566, 'JIMENEZ', 'DIRECTOR', 7839, '1981-04-02', 386750, NULL, 20);

INSERT INTO EMPLE
VALUES(7654, 'MARTIN', 'VENDEDOR', 7698, '1981-09-29', 162500, 182000, 30);

INSERT INTO EMPLE
VALUES(7698, 'NEGRO', 'DIRECTOR', 7839, '1981-05-01', 370500, NULL, 30);

INSERT INTO EMPLE
VALUES(7788, 'GIL', 'ANALISTA', 7566, '1981-11-09', 390000, NULL, 20);

INSERT INTO EMPLE
VALUES(7839, 'REY', 'PRESIDENTE', NULL, '1981-11-17', 650000, NULL, 10);

INSERT INTO EMPLE
VALUES(7844, 'TOVAR', 'VENDEDOR', 7698, '1981-09-08', 195000, 0, 30);

INSERT INTO EMPLE
VALUES(7876, 'ALONSO', 'EMPLEADO', 7788, '1981-09-23', 143000, NULL, 20);

INSERT INTO EMPLE
VALUES(7900, 'JIMENO', 'EMPLEADO', 7698, '1981-12-03', 1235000, NULL, 30);

INSERT INTO EMPLE
VALUES(7902, 'FERNANDEZ', 'ANALISTA', 7566, '1981-12-03', 390000, NULL, 20);

INSERT INTO EMPLE
VALUES(7934, 'MUÑOZ', 'EMPLEADO', 7782, '1982-01-23', 169000, NULL, 10);

INSERT INTO HERRAMIENTAS
VALUES('ALICATES', 1, 10);
INSERT INTO HERRAMIENTAS
VALUES('CORTADOR', 4, 5);
INSERT INTO HERRAMIENTAS
VALUES('DESTORNILLADOR', 3, 7);
INSERT INTO HERRAMIENTAS
VALUES('ESCOFINA', 6, 5);
INSERT INTO HERRAMIENTAS
VALUES('GUANTES', 2, 7);
INSERT INTO HERRAMIENTAS
VALUES('LIMA', 6, 10);
INSERT INTO HERRAMIENTAS
VALUES('MARTILLO', 3, 10);
INSERT INTO HERRAMIENTAS
VALUES('METRO', 5, 15);
INSERT INTO HERRAMIENTAS
VALUES('SIERRA', 4, 5);
INSERT INTO HERRAMIENTAS
VALUES('SOLDADOR', 1, 15);

INSERT INTO HOSPITALES
VALUES(1, 'RAFAEL MENDEZ', 'GRAN VIA, 7', 250);
INSERT INTO HOSPITALES
VALUES(2, 'REINA SOFIA', 'JUNTERONES, 5', 225);
INSERT INTO HOSPITALES
VALUES(3, 'PRINCIPE ASTURIAS', 'AVENIDA COLON', 150);
INSERT INTO HOSPITALES
VALUES(4, 'VIRGEN DE LA ARRIXACA', 'AVENIDA JUAN CARLOS, 1', 250);

INSERT INTO PERSONAS
VALUES(1,'12345678', 'GARCIA HERNANDEZ, ELADIO', 'CONSERJE', 1500);
INSERT INTO PERSONAS
VALUES(4,'22233311', 'MARTINEZ MOLINA, GLORIA', 'MEDICO', 1600);
INSERT INTO PERSONAS
VALUES(2,'22233322', 'TRISTAN GARCIA, ANA', 'MEDICO', 1900);
INSERT INTO PERSONAS
VALUES(2,'22233333', 'MARTINES MOLINA, ANDRES', 'MEDICO', 1600);
INSERT INTO PERSONAS
VALUES(4,'33222111', 'MESA DEL CASTILLO, JUAN', 'MEDICO', 2200);
INSERT INTO PERSONAS
VALUES(3,'55544411', 'RUIZ HERNANDEZ, CARIDAD', 'MEDICO', 1900);
INSERT INTO PERSONAS
VALUES(4,'55544412', 'JIMENEZ JIMENEZ, DOLORES', 'CONSERJE', 1200);
INSERT INTO PERSONAS
VALUES(2,'55544433', 'GONZALES MARIN, ALICIA', 'CONSERJE', 1200);
INSERT INTO PERSONAS
VALUES(1,'66655544', 'CASTILLO MONTES, PEDRO', 'MEDICO', 1700);
INSERT INTO PERSONAS
VALUES(1,'87654321', 'FUENTES BERMEJO, CARLOS', 'DIRECTOR', 2000);
INSERT INTO PERSONAS
VALUES(3,'99988333', 'SERRANO DIAZ, ALEJANDRO', 'DIRECTOR', 2400);



INSERT INTO MEDICOS
VALUES(4,'22233311', 'MARTINEZ MOLINA, GLORIA','PSIQUIATRA');
INSERT INTO MEDICOS
VALUES(2,'22233322', 'TRISTAN GARCIA, ANA','CIRUJANO');
INSERT INTO MEDICOS
VALUES(2,'22233333', 'MARTINES MOLINA, ANDRES','CIRUJANO');
INSERT INTO MEDICOS
VALUES(4,'33222111', 'MESA DEL CASTILLO, JUAN','DERMATOLOGO');
INSERT INTO MEDICOS
VALUES(1,'66655544', 'CASTILLO MONTES, PEDRO','PSIQUIATRA');
INSERT INTO MEDICOS
VALUES(3,'55544411', 'RUIZ HERNANDEZ, CARIDAD', NULL);

#1.Visualizar el número de empleados de cada departamento. Utilizar GROUP BY para agrupar por departamento.
SELECT COUNT(EMP_NO)
FROM EMPLE
GROUP BY DEPT_NO;
#2.Visualizar los departamentos con más de 5 empleados. Utilizar GROUP BY para agrupar por departamento y HAVING 
#para establecer la condición sobre los grupos.
SELECT DEPT_NO
FROM EMPLE
GROUP BY DEPT_NO
HAVING COUNT(EMP_NO)>5;
#3.Hallar la media de los salarios de cada departamento (utilizar la función avg y GROUP BY).
SELECT AVG(SALARIO)
FROM EMPLE
GROUP BY DEPT_NO;
#4.Visualizar el nombre de los empleados vendedores del departamento ʻVENTASʼ (Nombre del departamento=ʼVENTASʼ, 
#oficio=ʼVENDEDORʼ).
SELECT E.APELLIDO
FROM DEPART D, EMPLE E
WHERE D.DNOMBRE = 'VENTAS'
AND E.OFICIO='VENDEDOR';
#5.Visualizar el número de vendedores del departamento ʻVENTASʼ (utilizar la función COUNT sobre la consulta anterior).
SELECT COUNT(E.APELLIDO)
FROM DEPART D, EMPLE E
WHERE D.DNOMBRE = 'VENTAS'
AND E.OFICIO='VENDEDOR';
#6.Visualizar los oficios de los empleados del departamento ʻVENTASʼ.
SELECT E.OFICIO
FROM EMPLE E, DEPART D
WHERE E.DEPT_NO=E.DEPT_NO
AND D.DNOMBRE='VENTAS';
#7.A partir de la tabla EMPLE, visualizar el número de empleados de cada departamento cuyo oficio sea ʻEMPLEADOʼ 
#(utilizar GROUP BY para agrupar por departamento. En la cláusula WHERE habrá que indicar que el oficio es ʻEMPLEADOʼ).
SELECT COUNT(EMP_NO)
FROM EMPLE
WHERE OFICIO='EMPLEADO'
GROUP BY DEPT_NO;
#8.Visualizar el departamento con más empleados.
SELECT MAX(COUNT(EMP_NO))
FROM EMPLE;
#9.Mostrar los departamentos cuya suma de salarios sea mayor que la media de salarios de todos los empleados.
SELECT DEPT_NO
FROM EMPLE
GROUP BY DEPT_NO
HAVING SUM(SALARIO)>AVG(SALARIO);
#10.Para cada oficio obtener la suma de salarios.
SELECT SUM(SALARIO)
FROM EMPLE
GROUP BY OFICIO;
#11.Visualizar la suma de salarios de cada oficio del departamento ʻVENTASʼ.
SELECT SUM(E.SALARIO)
FROM EMPLE E, DEPART D
WHERE E.DEPT_NO=D.DEPT_NO
AND D.DNOMBRE='VENTAS';
#12.Visualizar el número de departamento que tenga más empleados cuyo oficio sea empleado.
SELECT MAX(COUNT(DEPT_NO))
FROM EMPLE
WHERE OFICIO = 'EMPLEADO';
#13.Mostrar el número de oficios distintos de cada departamento.
SELECT COUNT(DISTINCT OFICIO)
FROM EMPLE;
#14.Mostrar los departamentos que tengan más de dos personas trabajando en la misma profesión.
SELECT DEPT_NO
FROM EMPLE
GROUP BY DEPT_NO
HAVING COUNT(OFICIO)>2;
#15. Dada la tabla HERRAMIENTAS, visualizar por cada estantería la suma de las unidades.
#Estantería SUMA
SELECT SUM(UNIDADES)
FROM HERRAMIENTAS
GROUP BY ESTANTERIA;
#16.Visualizar la estantería con más unidades de la tabla HERRAMIENTAS.
SELECT MAX(SUM(UNIDADES))
FROM HERRAMIENTAS;
#17.Mostrar el número de médicos que pertenecen a cada hospital, ordenado por número descendente de hospital.
SELECT COUNT(DNI)
FROM MEDICOS
ORDER BY COD_HOSPITAL;
#18.Realizar una consulta en la que se muestre por cada hospital el nombre de las especialidades que tiene.
SELECT ESPECIALIDAD
FROM MEDICOS;
#19.Realizar una consulta en la que aparezca por cada hospital y en cada especialidad el número de médicos 
#(tendrás que partir de la consulta anterior y utilizar GROUP BY).
SELECT ESPECIALIDAD, COUNT(DNI)
FROM MEDICOS
GROUP BY ESPECIALIDAD;
#20.Obtener por cada hospital el número de empleados.
SELECT COUNT(DNI)
FROM MEDICOS
ORDER BY COD_HOSPITAL;
#21.Obtener por cada especialidad el número de trabajadores.
SELECT COUNT(DNI)
FROM MEDICOS
GROUP BY ESPECIALIDAD;
#22.Visualizar la especialidad que tenga más médicos.
SELECT MAX(COUNT(DNI))
FROM MEDICOS
GROUP BY ESPECIALIDAD;
#23.¿Cuál es el nombre del hospital que tiene mayor número de plazas?
SELECT MAX(NUM_PLAZAS), NOMBRE
FROM HOSPITALES
GROUP BY NOMBRE;
#24.Visualizar las diferentes estanterías de la tabla HERRAMIENTAS ordenados descendentemente por estantería.
SELECT DISTINCT ESTANTERIA
FROM HERRAMIENTAS
ORDER BY ESTANTERIA DESC;
#25.Averiguar cuántas unidades tiene cada estantería.
SELECT SUM(UNIDADES)
FROM HERRAMIENTAS
GROUP BY ESTANTERIA;
#26.Visualizar las estanterías que tengan más de 15 unidades
SELECT SUM(UNIDADES), ESTANTERIA
FROM HERRAMIENTAS
GROUP BY ESTANTERIA
HAVING SUM(UNIDADES)>15;
#27.¿Cuál es la estantería que tiene más unidades?
SELECT MAX(UNIDADES), ESTANTERIA
FROM HERRAMIENTAS
GROUP BY ESTANTERIA;
#28.A partir de las tablas EMPLE y DEPART mostrar los datos del departamento que no tiene ningún empleado.
SELECT D.*
FROM EMPLE E, DEPART D
WHERE E.DEPT_NO(+)=D.DEPT_NO
AND E.EMP_NO IS NULL;
#29.Mostrar el número de empleados de cada departamento. En la salida se debe mostrar también los departamentos 
#que no tienen ningún empleado.
SELECT COUNT(EMP_NO)
FROM EMPLE E, D.DEPT_NO
WHERE E.DEPT(+)=D.DEPT_NO;
#30.Obtener la suma de salarios de cada departamento, mostrando las columnas DEPT_NO, SUMA DE SALARIOS y DNOMBRE. 
#En el resultado también se deben mostrar los departamentos que no tienen asignados empleados.
SELECT SUM(E.SALARIO), E.DEPT_NO, D.DNOMBRE
FROM EMPLE E, D.DEPT_NO
WHERE E.DEPT(+)=D.DEPT_NO
GROUP BY E.DEPT_NO, D.DNOMBRE;
#31.Utilizar la función IFNULL en la consulta anterior para que en el caso de que un departamento no tenga empleados, 
#aparezca como suma de salarios el valor 0.
SELECT SUM(IFNULL(O,E.SALARIO)), E.DEPT_NO, D.DNOMBRE
FROM EMPLE E, D.DEPT_NO
WHERE E.DEPT(+)=D.DEPT_NO
GROUP BY E.DEPT_NO, D.DNOMBRE;
#32.Obtener el número de médicos que pertenecen a cada hospital, mostrando las columnas COD_HOSPITAL, NOMBRE y NÚMERO DE 
#MÉDICOS. En el resultado deben aparecer también los datos de los hospitales que no tienen médicos.
SELECT COUNT(M.DNI), M.COD_HOSPITAL, H.NOMBRE
FROM MEDICOS M, HOSPITALES H
WHERE M.COD_HOSPITAL(+)=H.COD_HOSPITAL;